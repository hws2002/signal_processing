<div style="display: flex; justify-content: space-between; font-size: 9px; margin-bottom: 10px;">
  <span>2021080070 计31 韩佑硕</span>
  <span><script>document.write(new Date().toISOString().split('T')[0])</script></span>
</div>

# 实验一 ： 傅里叶级数的可视化

# 实验环境
- **Operating System**: Windows-10-10.0.26100-SP0
- **Hardware**: Intel(R) Core(TM) i5-1220H (2.70 GHz)
  - CPU count: 12
  - Logical CPU count: 16

# 代码分析

## `visualize()`

### 整体结构

将傅里叶级数可视化为一系列旋转的圆。随着时间推移，圆旋转并追踪最后一个圆的端点绘制原始函数。


**1. 原始函数**
```python
  x = np.linspace(0, 2π, 1000)   # 将 0~2π 分成 1000 个点
  y[i] = function(x[i])          # 每个点的 f(t) 值
```

**2. 圆数据数组**

```python
    point_pos_array = np.zeros((2*N_Fourier + 2, 2))  # 每个圆的端点位置 [x, y]
    radius_array = np.zeros(2*N_Fourier + 1)          # 每个圆的半径
```

索引结构：

- [0]: 原点(0, 0)
- [1]: a0 圆的端点
- [2]: b1 圆的端点
- [3]: a1 圆的端点
- [4]: b2 圆的端点
- [5]: a2 圆的端点

### 旋转向量
- 旋转向量: radius × [cos(ωt), sin(ωt)]
- 角速度 ω = (j+1) → 1, 2, 3, ...

**3. b_n 圆**
- 正弦项: b_n × sin(nt) 分解为 x, y 分量

**4. a_n 圆**
- 余弦项: a_n × cos(nt) = a_n × [-sin(nt), cos(nt)]
- 比 b_n 圆提前 90 度旋转

**5. 绘制图形**

**6. 生成动画 (exp2.py:122-125)**
- 100 帧 → mp4 视频

结果：圆旋转绘制出半圆波的动画！

**核心原理**

最后一个圆的端点 = (x_end, y_end)

y_end = a0 + a1·cos(1·t) + b1·sin(1·t) + a2·cos(2·t) + b2·sin(2·t) + ...
      = 傅里叶级数近似值！

- y_end ≈ f(t)：N_Fourier 越大越精确

## 自加函数 `compare_values`

为了量化评估傅里叶级数近似的精度，添加了实际值与预测值的对比分析功能。

该函数计算给定时间点 $t$ 处的傅里叶级数近似值：
$$
\hat{f}(t) = a_0 + \sum_{n=1}^{N} [a_n \cos(nt) + b_n \sin(nt)]
$$

### 2. 误差指标

在100个测试点上计算以下误差指标：

**均方误差 (MSE)**
$$
\text{MSE} = \frac{1}{n} \sum_{i=1}^{n} (f(t_i) - \hat{f}(t_i))^2
$$

**平均绝对误差 (MAE)**
$$
\text{MAE} = \frac{1}{n} \sum_{i=1}^{n} |f(t_i) - \hat{f}(t_i)|
$$

**最大误差**
$$
\text{Max Error} = \max_{i} |f(t_i) - \hat{f}(t_i)|
$$

### 3. 可视化输出

生成双子图对比分析：
- **左图**：蓝色实线（实际值）vs 红色虚线（预测值）
- **右图**：绿色线显示误差 $e(t) = f(t) - \hat{f}(t)$ 随时间的变化

### 4. 结果分析

**方波信号特点**：
- 不连续点处出现 Gibbs 现象
- $N \geq 32$ 时大部分区间近似良好
- 最大误差集中在不连续点附近

**半圆波信号特点**：
- 连续且光滑，收敛速度快
- $N \geq 64$ 时精度很高
- 端点处（导数无穷大）误差略大


# 任务一 ： 可视化方波信号

## 傅里叶系数

### 原函数分析

给定函数 `f(t) = 0.5·sgn(sin(t)) + 0.5` 的周期为 $T = 2\pi$，具有如下方波（Square Wave）形式：

$$
f(t) = \begin{cases} 1 & \text{if } 0 < t < \pi \\ 0 & \text{if } \pi < t < 2\pi \end{cases}
$$

### 1. $a_0$ 计算

$$
\begin{aligned}
a_0 &= \frac{1}{2\pi} \int_{0}^{2\pi} f(t) \,dt \\
&= \frac{1}{2\pi} \left( \int_{0}^{\pi} 1 \,dt + \int_{\pi}^{2\pi} 0 \,dt \right) \\
&= \frac{1}{2\pi} \left( [t]_{0}^{\pi} \right) \\
&= \frac{1}{2\pi} (\pi) = \frac{1}{2}
\end{aligned}
$$

### 2. $a_n$ 计算（余弦系数）

对于 $n \geq 1$：
$$
\begin{aligned}
a_n &= \frac{1}{\pi} \int_{0}^{2\pi} f(t) \cos(nt) \,dt \\
&= \frac{1}{\pi} \int_{0}^{\pi} 1 \cdot \cos(nt) \,dt \\
&= \frac{1}{\pi} \left[ \frac{\sin(nt)}{n} \right]_{0}^{\pi} \\
&= \frac{1}{n\pi} (\sin(n\pi) - \sin(0)) \\
&= 0
\end{aligned}
$$

因此所有余弦系数为 0。


### 3. $b_n$ 计算（正弦系数）
$$
\begin{aligned}
b_n &= \frac{1}{\pi} \int_{0}^{2\pi} f(t) \sin(nt) \,dt \\
&= \frac{1}{\pi} \int_{0}^{\pi} 1 \cdot \sin(nt) \,dt \\
&= \frac{1}{\pi} \left[ -\frac{\cos(nt)}{n} \right]_{0}^{\pi} \\
&= -\frac{1}{n\pi} (\cos(n\pi) - \cos(0)) \\
&= -\frac{1}{n\pi} ((-1)^n - 1)
\end{aligned}
$$

即：

$$
b_n =
\begin{cases}
\dfrac{2}{n\pi}, & \text{if } n \equiv 1 \pmod{2} \\[6pt]
0, & \text{if } n \equiv 0 \pmod{2}
\end{cases}
$$


### 最终傅里叶级数

综合计算出的系数，最终傅里叶级数为：
$$
f(t) = \frac{1}{2} + \sum_{n=1, 3, 5, \dots}^{\infty} \frac{2}{n\pi} \sin(nt)
$$

或者：
$$
f(t) = \frac{1}{2} + \frac{2}{\pi} \sum_{k=1}^{\infty} \frac{\sin((2k-1)t)}{2k-1}
$$

## 结果

### 实验数据汇总

对不同的傅里叶级数项数 $N$ 进行了近似精度测试，在100个等距采样点上计算误差指标。结果如下：

| $N$ | MSE | MAE | Max Error |
|-----|---------|---------|-----------|
| 2 | 0.046918 | 0.169873 | 0.500000 |
| 4 | 0.024661 | 0.108045 | 0.500000 |
| 8 | 0.012609 | 0.065535 | 0.500000 |
| 16 | 0.006531 | 0.038562 | 0.500000 |
| 32 | 0.003675 | 0.022067 | 0.500000 |
| 64 | 0.002671 | 0.012804 | 0.500000 |
| 128 | 0.002592 | 0.009578 | 0.500000 |

### 误差分析

**收敛趋势：**
- 随着 $N$ 的增加，MSE 和 MAE 持续下降
- MSE 从 0.047 ($N=2$) 降至 0.0026 ($N=128$)，下降约 **18倍**
- MAE 从 0.170 ($N=2$) 降至 0.0096 ($N=128$)，下降约 **17.7倍**
- **Max Error 始终保持 0.5**。这个跟后述的Gibbs现象有关。

**关键观察：**
1. **$N=2$**：MSE=0.047, MAE=0.17，仅能捕捉方波的基本跳变
2. **$N=4, 8$**：误差快速下降，MSE 减半
3. **$N=16,32$**：MAE < 0.04，大部分区域近似良好
4. **$N≥64$**：MAE < 0.013，误差集中在不连续点
5. **$N=128$**：MSE=0.0026，除跳变点外几乎完美

**Gibbs 现象 ：**
- **最大误差恒定在 0.5**：这是方波在不连续点 $t=0, \pi, 2\pi$ 处的 Gibbs 过冲
- 无论 $N$ 多大，跳变点处的过冲幅度约为跳变量的 9% (Gibbs 常数)
- 对于幅度为 1 的跳变，傅里叶级数在跳变点处收敛到 0.5（跳变前后平均值）
- 过冲使预测值在跳变点附近震荡，最大误差 = |1 - 0.5| = 0.5

**误差分布特征：**
- 平坦区域 ($t \in (0, \pi)$ 和 $t \in (\pi, 2\pi)$)：误差迅速减小
- 不连续点附近：出现震荡和过冲，误差难以消除
- 从样本数据可见：
  - $t=3.1733$ (接近 $\pi$)：即使 $N=128$，误差仍有 0.056
  - 远离不连续点的位置：$N=128$ 时误差 < 0.004

**性能提升规律：**

MSE 和 MAE 的下降速度逐渐减缓（与半圆波的指数级下降不同）：
- $N: 2 \to 4$, MSE: $0.047 \to 0.025$ (减少47%)
- $N: 4 \to 8$, MSE: $0.025 \to 0.013$ (减少49%)
- $N: 8 \to 16$, MSE: $0.013 \to 0.007$ (减少48%)
- $N: 16 \to 32$, MSE: $0.007 \to 0.004$ (减少44%)
- $N: 32 \to 64$, MSE: $0.004 \to 0.003$ (减少27%)
- $N: 64 \to 128$, MSE: $0.003 \to 0.003$ (减少3%)

**$N≥64$ 后收敛减缓**：因为误差主要集中在不连续点，Gibbs 现象无法通过增加项数消除。

### 可视化观察

对比曲线（左图）显示：  
* **$N=2, 4$**：红色虚线（预测值）呈现明显的正弦波叠加形态，无法逼近方波的陡峭跳变
* **$N=8, 16$**：跳变处开始出现震荡（Gibbs 现象），平坦区域拟合改善
* **$N=32, 64$**：平坦区域几乎完美重合，但在 $t=\pi$ 附近仍有明显过冲
* **$N≥64$**：除不连续点外，预测曲线与实际方波高度吻合

误差曲线（右图）显示：
- **不连续点处误差呈尖峰**：最大值固定在 0.5
- **平坦区域误差接近 0**：随 $N$ 增大快速收敛
- **Gibbs 震荡**：跳变点附近的误差呈现周期性震荡，震荡幅度随 $N$ 增大而减小，但震荡范围向跳变点收缩



# 任务二 ： 可视化半圆波信号

## 傅里叶系数

### 原函数分析

给定的半圆波信号（half-circle wave signal）函数如下：
$$
f(t) = \begin{cases} \sqrt{\pi^2 - (t-\pi)^2} & \text{if } t \in [0, 2\pi] \\ f(t-2\pi) & \text{if } t \notin [0, 2\pi] \end{cases}
$$
该函数是中心为 $(\pi, 0)$、半径为 $\pi$ 的上半圆，周期为 $T=2\pi$。

### 1. $a_0$ 计算


$$
a_0 = \frac{1}{2\pi} \int_{0}^{2\pi} f(t) \,dt = \frac{1}{2\pi} \int_{0}^{2\pi} \sqrt{\pi^2 - (t-\pi)^2} \,dt
$$
上述定积分等于半径为 $\pi$ 的半圆面积，因此：
$$
a_0 = \frac{1}{2\pi} \left( \frac{\pi^3}{2} \right) = \frac{\pi^2}{4}
$$

### 2. $b_n$

函数 $f(t)$ 关于 $t=\pi$ 左右对称，具有偶函数（even function）的特征。由于这种对称性，正弦系数 $b_n$ 均为 0。数学证明如下：
$$
b_n = \frac{1}{\pi} \int_{0}^{2\pi} f(t) \sin(nt) \,dt
$$
令 $u = t - \pi$，则 $t = u + \pi$，$dt = du$：
$$
\begin{aligned}
b_n &= \frac{1}{\pi} \int_{-\pi}^{\pi} \sqrt{\pi^2 - u^2} \sin(n(u+\pi)) \,du \\
&= \frac{1}{\pi} \int_{-\pi}^{\pi} \sqrt{\pi^2 - u^2} \left( \sin(nu)\cos(n\pi) + \cos(nu)\sin(n\pi) \right) \,du \\
&= \frac{(-1)^n}{\pi} \int_{-\pi}^{\pi} \underbrace{\sqrt{\pi^2 - u^2}}_{\text{偶函数}} \underbrace{\sin(nu)}_{\text{奇函数}} \,du
\end{aligned}
$$
偶函数与奇函数的乘积是奇函数，在对称区间 $[-\pi, \pi]$ 上的定积分为 0。
$$
b_n = 0
$$

### 3. $a_n$ 计算

对于 $n \geq 1$：

$$
a_n = \frac{1}{\pi} \int_{0}^{2\pi} f(t) \cos(nt) \,dt
$$
与 $b_n$ 同样，令 $u = t - \pi$：
$$
\begin{aligned}
a_n &= \frac{1}{\pi} \int_{-\pi}^{\pi} \sqrt{\pi^2 - u^2} \cos(n(u+\pi)) \,du \\
&= \frac{1}{\pi} \int_{-\pi}^{\pi} \sqrt{\pi^2 - u^2} \left( \cos(nu)\cos(n\pi) - \sin(nu)\sin(n\pi) \right) \,du \\
&= \frac{(-1)^n}{\pi} \int_{-\pi}^{\pi} \underbrace{\sqrt{\pi^2 - u^2}}_{\text{偶函数}} \underbrace{\cos(nu)}_{\text{偶函数}} \,du
\end{aligned}
$$
被积函数是偶函数，可以将积分区间减半并乘以 2：
$$
a_n = \frac{2(-1)^n}{\pi} \int_{0}^{\pi} \sqrt{\pi^2 - u^2} \cos(nu) \,du
$$
该积分难以直接计算，因此采用数值积分方法求解。 


## 数值积分
采用典型的机械积分法进行计算。

### Gauss-Legendre 积分法

**原理：**
- 在区间 $[-1, 1]$ 上使用优化的节点 $x_i$ 和权重 $w_i$
- 转换到任意区间 $[a, b]$：$t = \frac{b-a}{2}x_i + \frac{a+b}{2}$
- 积分近似：$\int_a^b f(t)\,dt \approx \frac{b-a}{2} \sum_{i=1}^{n} w_i \cdot f(t_i)$

**实现：**
```python
GL_nodes, GL_weights = np.polynomial.legendre.leggauss(NUM_POINTS)

def gauss_legendre(f, n, a, b):
    res = 0.0
    for i in range(NUM_POINTS):
        t = 0.5*(b-a)*GL_nodes[i] + 0.5*(a+b)
        w = GL_weights[i]
        res += w * f(t, n)
    res *= 0.5*(b-a)
    return res
```

**特点：**
- 实现非常简单（只需节点和权重）
- 对光滑函数具有高精度
- 但需要约 125 个节点才能在 `N_Fourier=128` 时获得稳定的近似值
- 特别是**在低 n 值（n=1,2）时不稳定**：端点 $t=\pi$ 处 $\sqrt{\pi^2-t^2} \to 0$ 且导数趋于无穷大，导致 GL 积分误差

**精度：**
- `NUM_POINTS = 300`：所有 N_Fourier 下稳定
- `NUM_POINTS = 125`：N_Fourier=128 以下可用
- `NUM_POINTS = 50`：低阶也会出现误差

## 结果

### 实验数据汇总

对不同的傅里叶级数项数 $N$ 进行了近似精度测试，在100个等距采样点上计算误差指标。结果如下：

| $N$ | MSE | MAE | Max Error |
|-----|---------|---------|-----------|
| 2 | 0.057117 | 0.149177 | 1.239647 |
| 8 | 0.010920 | 0.041603 | 0.682521 |
| 16 | 0.005205 | 0.021305 | 0.491135 |
| 32 | 0.002579 | 0.012229 | 0.350399 |
| 64 | 0.001252 | 0.006805 | 0.248903 |
| 128 | 0.000625 | 0.004236 | 0.176437 |

### 误差分析

**收敛趋势：**
- 随着 $N$ 的增加，所有误差指标呈现指数级下降
- MSE 从 0.057 ($N=2$) 降至 0.0006 ($N=128$)，下降约 **90倍**
- MAE 从 0.149 ($N=2$) 降至 0.004 ($N=128$)，下降约 **35倍**
- Max Error 从 1.240 ($N=2$) 降至 0.176 ($N=128$)，下降约 **7倍**

**关键观察：**
1. **$N=2$**：近似效果较差，最大误差超过1.2，仅能捕捉函数的基本形状
2. **$N=8, 16$**：误差快速下降，开始呈现半圆波的基本轮廓
3. **$N=32$**：MSE < 0.003，大部分区域近似良好
4. **$N≥64$**：MAE < 0.01，视觉上几乎完美重合
5. **$N=128$**：MSE仅为0.0006，达到极高精度

**误差分布特征：**
- 最大误差始终出现在 $t=0$ (和 $t=2\pi$) 处
- 这是因为半圆波在端点处导数趋于无穷大 ($\lim_{t\to 0^+} f'(t) = +\infty$)
- 中间区域 ($t \in [\pi/2, 3\pi/2]$) 收敛最快，误差最小
- Gibbs 现象不明显，因为函数本身连续且光滑（除端点外）

**性能提升规律：**

每当 $N$ 翻倍，MSE 大约减半：
- $N: 8 \to 16$, MSE: $0.0109 \to 0.0052$ (减少52%)
- $N: 16 \to 32$, MSE: $0.0052 \to 0.0026$ (减少50%)
- $N: 32 \to 64$, MSE: $0.0026 \to 0.0013$ (减少51%)
- $N: 64 \to 128$, MSE: $0.0013 \to 0.0006$ (减少50%)

这表明傅里叶级数对光滑周期函数具有良好的收敛性。

### 可视化观察

对比曲线（左图）显示：  
* **$N=2 \sim 8$**：红色虚线（预测值）在端点附近明显偏离蓝色实线（实际值）
* **$N=16, 32$**：整体拟合良好，但在 $t \in [0, 1]$ 和 $t \in [5, 6]$ 区间仍有轻微波动
* **$N≥64$**：预测曲线几乎完全重合于实际曲线，仅在端点处有微小偏差

误差曲线（右图）显示：
- 端点处误差呈现尖峰
- 中间平滑区域误差接近0
- 随着 $N$ 增大，尖峰高度显著降低

### 与方波对比

| 特征 | 方波 | 半圆波  |
|------|-------------------|------------------------|
| 连续性 | 不连续（有跳变） | 连续且光滑（除端点外） |
| Max Error | 恒定 (0.5) | 随 $N$ 下降 (1.24→0.18) |
| Gibbs 现象 | 显著 | 不明显 |
| $N=128$ 时 MSE | 0.0026 | 0.0006 |
| 收敛速度 | 较慢（受限于跳变点） | 快（指数级） |

## 其他优化
使用 lru_cache 缓存傅里叶系数的计算结果，避免重复计算，提高程序效率。